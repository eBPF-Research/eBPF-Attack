// +build ignore

#define DEBUG_LOG

#include "ringbuffer.h"
#include <stdbool.h>

char __license[] SEC("license") = "Dual MIT/GPL";

#define TASK_COMM_LEN 16

static __inline bool inore_process() {
	char comm[TASK_COMM_LEN] = {0};
	bpf_get_current_comm(&comm, sizeof(comm));
	bpf_log("comm: %s\n", comm);
	// 只抓取bash进程
	// if (memcmp(comm, "sh", sizeof("sshd")) != 0
	// 	|| memcmp(comm, "bash", sizeof("bash")) != 0) {
	// 	return true;
	// }
	return false;
}


SEC("raw_tracepoint/sys_enter")
int raw_tp_sys_enter(struct bpf_raw_tracepoint_args *ctx) {
	if (inore_process()) return 0;
	char log[LOG_ENTRY_SIZE] = "sys_enter";
	send_event_log(EVENT_LOG, 2, log);
	return 0;
}

SEC("raw_tracepoint/sys_exit")
int raw_tp_sys_exit(struct bpf_raw_tracepoint_args *ctx) {
	if (inore_process()) return 0;
	char log[LOG_ENTRY_SIZE] = "sys_exit";
	send_event_log(EVENT_LOG, 2, log);
	return 0;
}